{"version":3,"file":"megamenu.js","sources":["../src/o-megamenu.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Boosted (v4.4.1): o-megamenu.js\n * Licensed under MIT (https://github.com/Orange-OpenSource/Orange-Boosted-Bootstrap/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport $ from 'jquery'\nimport Util from './util'\n\n/* eslint no-magic-numbers: [\"error\", { \"ignore\": [1,2] }] */\n\n/**\n * ------------------------------------------------------------------------\n * Constants\n * ------------------------------------------------------------------------\n */\n\nconst NAME = 'megamenu'\nconst VERSION = '4.4.1'\nconst DATA_KEY = 'bs.megamenu'\nconst JQUERY_NO_CONFLICT = $.fn[NAME]\nconst ARROW_LEFT_KEYCODE = 37 // KeyboardEvent.which value for left arrow key\nconst ARROW_RIGHT_KEYCODE = 39 // KeyboardEvent.which value for right arrow key\nconst ARROW_UP_KEYCODE = 38 // KeyboardEvent.which value for up arrow key\nconst ARROW_DOWN_KEYCODE = 40 // KeyboardEvent.which value for down arrow key\nconst TIMEOUT = 1000 // Timeout befor focusing first element\nconst PERCENTAGE = 100 // Width slide proportion\nconst SPLITLENGHT = 4\n\nconst ClassName = {\n  TRANSITIONING: 'transitioning',\n  ACTIVE: 'active'\n}\n\nconst Selector = {\n  MEGAMENU    : '.mega-menu',\n  ROOT_NAV : '.mega-menu > .navbar-nav',\n  MEGAMENU_PANEL : '.mega-menu-panel',\n  MEGAMENU_NAV : '.nav-link + .navbar-nav',\n  NAV_MENU : '.navbar-nav',\n  NAV_ITEM : '.nav-item',\n  NAV_LINK : '.nav-link',\n  NAV_LINK_COLLAPSE : '.nav-link[data-toggle=collapse]',\n  NAV_LINK_BACK : '.nav-link.back',\n  NAV_LINK_EXPANDED : '.nav-link[aria-expanded=true]',\n  CURRENT: '.nav-link[aria-current=\"page\"]'\n}\n\n\n/**\n * ------------------------------------------------------------------------\n * Class Definition\n * ------------------------------------------------------------------------\n */\n\nclass MegaMenu {\n  constructor(element, config) {\n    this._element = element\n    this._$navLinks = $(this._element).find(Selector.NAV_LINK)\n    this._$goForwardLinks = $(this._element).find(Selector.MEGAMENU_NAV).prev(Selector.NAV_LINK)\n    this._$goBackLinks = $(this._element).find(Selector.NAV_LINK_BACK)\n    this._$topCollapseMenus = $(this._element).find(Selector.MEGAMENU_PANEL)\n    this._$navLinkCollapses = $(this._element).find(Selector.NAV_LINK_COLLAPSE)\n    this._config = config\n    if (typeof this._config.noFocus === 'undefined') {\n      this._config.noFocus = false\n    }\n    this._addEventListeners()\n    this._addAriaAttributes(this._element)\n    this.goTo = this._initPosition\n  }\n\n  // getters\n\n  static get VERSION() {\n    return VERSION\n  }\n\n  // public\n\n  // private\n\n  _addEventListeners() {\n    this._$goForwardLinks.on('click', (event) => this._goForward(event))\n    this._$goBackLinks.on('click', (event) => this._goBackward(event))\n    this._$navLinks.on('keydown', (event) => this._manageKeyDown(event))\n    if (!this._config.noFocus) {\n      this._$topCollapseMenus.on('shown.bs.collapse', this._collapseFocus)\n    }\n    this._$navLinkCollapses.on('click', (event) => this._handleCollapseToggle(event))\n  }\n\n  _addAriaAttributes(element) {\n    const $subNavs = $(element).find(Selector.MEGAMENU_NAV)\n    const $parents = $(element).find(Selector.CURRENT).parents(Selector.NAV_ITEM)\n\n    $(element).attr('role', 'application')\n    $(element).find('> .navbar-nav').attr('role', 'menu')\n    $(element).find(Selector.MEGAMENU_PANEL).attr('role', 'menu')\n    $(element).find('.nav-link[data-toggle=collapse]').attr('role', 'menuitem')\n    $(element).find(Selector.NAV_LINK_BACK).attr('aria-hidden', 'true')\n    $(element).find(Selector.NAV_ITEM).attr('role', 'presentation')\n\n    $parents.each(function () {\n      $(this).find(Selector.NAV_LINK).first().attr('aria-current', 'true')\n    })\n\n    $subNavs.each(function () {\n      const navId = Util.getUID(NAME)\n      const $thisNavToggler = $(this).prev(Selector.NAV_LINK)\n      const $thisNav = $(this)\n      const $thisNavBackLink = $thisNav.find(Selector.NAV_LINK_BACK)\n\n      $thisNav.attr({\n        id: navId,\n        role: 'menu'\n      })\n      $thisNavToggler.attr({\n        role: 'menuitem',\n        'aria-controls': navId,\n        'aria-expanded': false,\n        'aria-haspopup': true\n      })\n      $thisNavBackLink.attr({\n        role: 'menuitem',\n        'aria-controls': navId\n      })\n    })\n  }\n\n  _initPosition(target) {\n    if (!$(target).length) {\n      return\n    }\n\n    const $target = $(target).first()\n    const position = $target.parents().index(this._element)\n    const rootPosition = $('.mega-menu-panel .nav-link').first().parents().index($('.mega-menu'))\n    const translatePercentage = -(position - rootPosition) * PERCENTAGE / 2\n    const $thisNav = $target.closest(Selector.NAV_MENU)\n    const $rootNav = $target.closest(Selector.ROOT_NAV)\n\n    $rootNav.addClass(ClassName.TRANSITIONING)\n    this._$navLinkCollapses.removeClass(ClassName.ACTIVE)\n\n    // open collapse\n    if ($target.attr('data-toggle') === 'collapse') {\n      $target.siblings(Selector.MEGAMENU_PANEL).collapse('show')\n      $target.addClass(ClassName.ACTIVE)\n      this._$topCollapseMenus.not($target.siblings(Selector.MEGAMENU_PANEL)).collapse('hide')\n      $(this._element).height('auto')\n      $rootNav.css('transform', 'translateX(0%)')\n    } else {\n      $target.closest(Selector.MEGAMENU_PANEL).collapse('show')\n      $target.closest(Selector.NAV_LINK_COLLAPSE).addClass(ClassName.ACTIVE)\n      this._$topCollapseMenus.not($target.closest(Selector.MEGAMENU_PANEL)).collapse('hide')\n\n      // show menu and hide other\n      $target.parents(Selector.NAV_MENU).show()\n\n      // set aria on parent links\n      $target.parents(Selector.NAV_ITEM).find('> .nav-link').not($target).attr({\n        tabindex: -1,\n        'aria-hidden': true,\n        'aria-expanded': true\n      })\n\n      // translate to pos\n      $rootNav.css('transform', `translateX(${translatePercentage}%)`)\n      if (translatePercentage) {\n        // adapt main collapse height to target height\n        $(this._element).height($thisNav.height())\n      } else {\n        $(this._element).height('auto')\n      }\n    }\n\n    // set focus on target link\n    setTimeout(() =>  {\n      if (!this._config.noFocus) {\n        // set focus on target link\n        $target.trigger('focus')\n      }\n\n      $rootNav.removeClass(ClassName.TRANSITIONING)\n    }, TIMEOUT)\n  }\n\n  _manageKeyDown(event) {\n    const $thisTarget = $(event.target)\n\n    // test key code\n    if (/input|textarea/i.test(event.target.tagName)) {\n      return\n    }\n\n    // proceed according to key code\n    switch (event.which) {\n      case ARROW_LEFT_KEYCODE:\n        this._goBackward(event)\n        break\n      case ARROW_RIGHT_KEYCODE:\n        this._goForward(event)\n        break\n      case ARROW_UP_KEYCODE:\n        // focus prev nav link\n        $thisTarget.parent().prev().find('>.nav-link').not(Selector.NAV_LINK_BACK).trigger('focus')\n        break\n      case ARROW_DOWN_KEYCODE:\n        // focus next nav link\n        $thisTarget.parent().next().find('>.nav-link').trigger('focus')\n        break\n      default:\n    }\n  }\n\n  _collapseFocus() {\n    $(this).find(Selector.NAV_LINK).not(Selector.NAV_LINK_BACK).first().trigger('focus')\n  }\n\n  _handleCollapseToggle(e) {\n    const $this = $(e.target)\n    const $thisCollapse = $($this.attr('href'))\n\n    $this.addClass(ClassName.ACTIVE)\n    this._$navLinkCollapses.not($this).removeClass(ClassName.ACTIVE)\n    this._$topCollapseMenus.not($thisCollapse).removeClass(ClassName.ACTIVE).collapse('hide')\n  }\n\n  _goForward(e) {\n    e.preventDefault()\n    const $this = $(e.target)\n    const $thisNav = $this.closest(Selector.NAV_MENU)\n    const $targetNav =  $this.next(Selector.NAV_MENU)\n    const $rootNav = $this.closest(Selector.ROOT_NAV)\n    const $thisNavToggler = $this\n    const currentTranslatePos = parseInt($rootNav.css('transform').split(',')[SPLITLENGHT], 10)\n    const navWidth = $rootNav.width()\n    const currentTranslatePercentage = PERCENTAGE * currentTranslatePos / navWidth\n\n    if (!$this.next(Selector.NAV_MENU).length || $rootNav.hasClass(ClassName.TRANSITIONING)) {\n      return false\n    }\n\n    $rootNav.addClass(ClassName.TRANSITIONING)\n\n    // hide all nav on same level\n    $thisNav.find(Selector.NAV_MENU).hide()\n\n    // show target navbar-nav\n    $targetNav.show()\n\n    // adapt main collapse height to target height\n    $(Selector.MEGAMENU).height($targetNav.height())\n\n    // make only visible elements focusable\n    if (!currentTranslatePercentage) {\n      $rootNav.find('>.nav-item .nav-link').attr({\n        tabindex: -1,\n        'aria-hidden': true\n      })\n    }\n    $thisNav.find(Selector.NAV_LINK).attr({\n      tabindex: -1,\n      'aria-hidden': true\n    })\n    $targetNav.find(Selector.NAV_LINK).attr({\n      tabindex: 0,\n      'aria-hidden': false\n    })\n\n    // translate menu\n    $rootNav.css('transform', `translateX(${currentTranslatePercentage - PERCENTAGE}%)`)\n\n    // focus on target nav first item\n    $rootNav.one('transitionend', () => {\n      $thisNavToggler.attr('aria-expanded', true)\n      $targetNav.find(Selector.NAV_LINK).not(Selector.NAV_LINK_BACK).first().trigger('focus')\n      $rootNav.removeClass(ClassName.TRANSITIONING)\n    })\n    return true\n  }\n\n  _goBackward(e) {\n    e.preventDefault()\n\n    const $this = $(e.target)\n    const $thisNav = $this.closest(Selector.NAV_MENU)\n    const $targetNav = $thisNav.parent().closest(Selector.NAV_MENU)\n    const $rootNav = $this.closest(Selector.ROOT_NAV)\n    const $targetNavToggler = $targetNav.find(Selector.NAV_LINK_EXPANDED)\n    const currentTranslatePos = parseInt($rootNav.css('transform').split(',')[SPLITLENGHT], 10)\n    const navWidth = $rootNav.width()\n    const currentTranslatePercentage = PERCENTAGE * currentTranslatePos / navWidth\n\n    if (!currentTranslatePercentage || $rootNav.hasClass(ClassName.TRANSITIONING)) {\n      return false\n    }\n\n    $rootNav.addClass(ClassName.TRANSITIONING)\n    // reset main collapse height\n    $(Selector.MEGAMENU).height('auto')\n\n    // make only visible elements focusable\n    $targetNav.find(Selector.NAV_LINK).attr({\n      tabindex: 0,\n      'aria-hidden': false\n    })\n    if (currentTranslatePercentage === -PERCENTAGE) {\n      $rootNav.find('>.nav-item .nav-link').attr({\n        tabindex: 0,\n        'aria-hidden': false\n      })\n    }\n\n    // translate menu\n    $rootNav.css('transform', `translateX(${currentTranslatePercentage + PERCENTAGE}%)`)\n\n    // focus on target nav first item\n    $rootNav.one('transitionend', () => {\n      $targetNavToggler.attr('aria-expanded', false)\n      $targetNavToggler.trigger('focus')\n      $thisNav.hide()\n      $rootNav.removeClass(ClassName.TRANSITIONING)\n    })\n    return true\n  }\n\n  // static\n\n  static _jQueryInterface(config) {\n    return this.each(function () {\n      if (!$(this).is(Selector.MEGAMENU)) {\n        throw new TypeError('Element is not a mega menu')\n      }\n\n      if (!config) {\n        config = {}\n      } else if (config.noFocus && typeof config.noFocus !== 'boolean') {\n        // param = true\n        throw new TypeError('no-focus parameter must be boolean')\n      }\n\n      let data = $(this).data(DATA_KEY)\n\n      if (!data) {\n        data = new MegaMenu(this, config)\n        $(this).data(DATA_KEY, data)\n      }\n\n      if (config.target) {\n        if (typeof config.target !== 'string' || !/^[.#].*/.test(config.target)) {\n          throw new TypeError(`Selector \"${config.target}\" is not supported`)\n        }\n\n        data.goTo(config.target)\n      }\n    })\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * jQuery\n * ------------------------------------------------------------------------\n */\n\n$.fn[NAME]             = MegaMenu._jQueryInterface\n$.fn[NAME].Constructor = MegaMenu\n$.fn[NAME].noConflict  = () => {\n  $.fn[NAME] = JQUERY_NO_CONFLICT\n  return MegaMenu._jQueryInterface\n}\n\nexport default MegaMenu\n"],"names":["NAME","VERSION","DATA_KEY","JQUERY_NO_CONFLICT","$","fn","ARROW_LEFT_KEYCODE","ARROW_RIGHT_KEYCODE","ARROW_UP_KEYCODE","ARROW_DOWN_KEYCODE","TIMEOUT","PERCENTAGE","SPLITLENGHT","ClassName","TRANSITIONING","ACTIVE","Selector","MEGAMENU","ROOT_NAV","MEGAMENU_PANEL","MEGAMENU_NAV","NAV_MENU","NAV_ITEM","NAV_LINK","NAV_LINK_COLLAPSE","NAV_LINK_BACK","NAV_LINK_EXPANDED","CURRENT","MegaMenu","element","config","_element","_$navLinks","find","_$goForwardLinks","prev","_$goBackLinks","_$topCollapseMenus","_$navLinkCollapses","_config","noFocus","_addEventListeners","_addAriaAttributes","goTo","_initPosition","on","event","_goForward","_goBackward","_manageKeyDown","_collapseFocus","_handleCollapseToggle","$subNavs","$parents","parents","attr","each","first","navId","Util","getUID","$thisNavToggler","$thisNav","$thisNavBackLink","id","role","target","length","$target","position","index","rootPosition","translatePercentage","closest","$rootNav","addClass","removeClass","siblings","collapse","not","height","css","show","tabindex","setTimeout","trigger","$thisTarget","test","tagName","which","parent","next","e","$this","$thisCollapse","preventDefault","$targetNav","currentTranslatePos","parseInt","split","navWidth","width","currentTranslatePercentage","hasClass","hide","one","$targetNavToggler","_jQueryInterface","is","TypeError","data","Constructor","noConflict"],"mappings":"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"}